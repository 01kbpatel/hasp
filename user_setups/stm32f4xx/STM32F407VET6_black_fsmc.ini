;***************************************************;
;          STM32F4xx build with                     ;
;               - STM32F407VET6 black board         ;
;               - FSMC 16 bit ili9341 TFT           ;
;               - xpt2046 touch controller          ;
;***************************************************;

[env:STM32F407VET6_black_fsmc]
platform = ststm32
board = black_f407ve
;board_build.mcu = stm32f407vet6
; upload_protocol = dfu
upload_protocol = stlink
debug_tool = stlink
monitor_port = COM19     ; To change the port, use platform_override.ini
build_flags =
    ${env.build_flags}
    ${flags.stm32_flags}
    -I include/stm32f4
    -I include/GxTFT/src
    -I include/GxTFT/src/GxCTRL/GxCTRL_ILI9341
; -- TFT_eSPI build options ------------------------
    -D ILI9341_DRIVER=1
    -D TFT_WIDTH=240
    -D TFT_HEIGHT=320
    -D USER_SETUP_LOADED=1
    -D TOUCH_CS=PA6 ;NC
    -D TFT_RST=-1  ;D4
    -D STM32
    -D TFT_SPI3
    -D USE_DMA_TO_TFT
    -D HASP_USE_TASMOTA_SLAVE=1
    -D HASP_OUTPUT_PIN=PA1          ; User LED D2 on DevEBox board 
    -D HASP_INPUT_PIN=PA0           ; User Button K1 on DevEBox board
    -D STM32_SERIAL1                ; Set this option to use Serial1 as default sersial port, leave out if using Serial2
    -D HASP_USE_ETHERNET=1
    -D USE_BUILTIN_ETHERNET=1
    -D HAL_ETH_MODULE_ENABLED=1
    ; -D LAN8742A_PHY_ADDRESS=0x01U ; moved to include\stm32f4\hal_conf_custom.h
    ; -D DP83848_PHY_ADDRESS=0x01U

lib_deps =
    ${env.lib_deps}
    Ticker@^3.1.5
    ; STM32duino LwIP@^2.1.2
    ; STM32duino STM32Ethernet@^1.0.5
    https://github.com/stm32duino/LwIP.git
    https://github.com/stm32duino/STM32Ethernet.git
    https://github.com/khoih-prog/EthernetWebServer_STM32
    Adafruit GFX Library@^1.7.5
    ;https://github.com/ZinggJM/GxTFT.git
    XPT2046_Touchscreen

src_filter = +<*> -<.git/> -<.svn/> -<example/> -<examples/> -<test/> -<tests/> -<lv_lib_zifont/> +<stm32f4/>
